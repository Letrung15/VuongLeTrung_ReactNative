{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport { doc, getDoc, updateDoc } from \"firebase/firestore\";\nimport { auth, db } from \"../../../firebase\";\nexport var getCartItems = function () {\n  var _ref = _asyncToGenerator(function* () {\n    var userDocRef = doc(db, \"users\", auth.currentUser.uid);\n    var userDocSnapshot = yield getDoc(userDocRef);\n    var data = yield userDocSnapshot.data().cart;\n    return {\n      data: data,\n      success: true\n    };\n  });\n  return function getCartItems() {\n    return _ref.apply(this, arguments);\n  };\n}();\nexport var addToCart = function () {\n  var _ref2 = _asyncToGenerator(function* (itemId, qty) {\n    console.log(itemId, qty);\n    var productRef = doc(db, \"products\", itemId);\n    var userDocRef = doc(db, \"users\", auth.currentUser.uid);\n    var productSnapshot = yield getDoc(productRef);\n    var userDocSnapshot = yield getDoc(userDocRef);\n    if (userDocSnapshot.exists() && productSnapshot.exists()) {\n      var userData = userDocSnapshot.data();\n      var productData = productSnapshot.data();\n      var cartItems = userData.cart || [];\n      cartItems.push({\n        id: itemId,\n        title: productData.title,\n        brand: productData.brand,\n        price: productData.price,\n        image: productData.image,\n        qty: qty\n      });\n      yield updateDoc(userDocRef, {\n        cart: cartItems\n      });\n      console.log(\"items added to cart\");\n      return {\n        success: true,\n        data: cartItems\n      };\n    } else {\n      console.error(\"user or product doesnt exist\");\n    }\n  });\n  return function addToCart(_x, _x2) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport var removeItemById = function () {\n  var _ref3 = _asyncToGenerator(function* (id) {\n    var userDocRef = doc(db, \"users\", auth.currentUser.uid);\n    var userDocSnapshot = yield getDoc(userDocRef);\n    if (userDocSnapshot.exists()) {\n      var userData = userDocSnapshot.data();\n      var newCart = userData.cart.filter(function (item) {\n        return item.id !== id;\n      });\n      yield updateDoc(userDocRef, {\n        cart: newCart\n      });\n      var subTotal = newCart.reduce(function (acc, curr) {\n        return acc + Number(curr.price);\n      });\n      return {\n        data: newCart,\n        success: true,\n        subTotal: subTotal\n      };\n    } else {\n      console.log(\"user doesn't exists\");\n    }\n  });\n  return function removeItemById(_x3) {\n    return _ref3.apply(this, arguments);\n  };\n}();","map":{"version":3,"names":["doc","getDoc","updateDoc","auth","db","getCartItems","_ref","_asyncToGenerator","userDocRef","currentUser","uid","userDocSnapshot","data","cart","success","apply","arguments","addToCart","_ref2","itemId","qty","console","log","productRef","productSnapshot","exists","userData","productData","cartItems","push","id","title","brand","price","image","error","_x","_x2","removeItemById","_ref3","newCart","filter","item","subTotal","reduce","acc","curr","Number","_x3"],"sources":["D:/Android/vuongletrung/fashion/src/features/firebase/cart.js"],"sourcesContent":["import {  doc, getDoc, updateDoc } from \"firebase/firestore\";\nimport { auth, db } from \"../../../firebase\";\n\n\nexport const getCartItems = async() => {\n    const userDocRef = doc(db,\"users\",auth.currentUser.uid)\n    const userDocSnapshot = await getDoc(userDocRef)\n    const data = await userDocSnapshot.data().cart;\n    return {data,success:true};\n}\n\nexport const addToCart=async(itemId,qty)=>{\n    console.log(itemId,qty)\n    const productRef = doc(db,\"products\",itemId)\n    const userDocRef = doc(db,\"users\",auth.currentUser.uid)\n    const productSnapshot = await getDoc(productRef)\n    const userDocSnapshot = await getDoc(userDocRef)\n    if(userDocSnapshot.exists() && productSnapshot.exists()){\n        const userData = userDocSnapshot.data();\n        const productData = productSnapshot.data();\n        const cartItems = userData.cart || [];\n        cartItems.push({\n            id:itemId,\n            title:productData.title,\n            brand:productData.brand,\n            price:productData.price,\n            image:productData.image,\n            qty:qty,\n        })\n        await updateDoc(userDocRef,{cart:cartItems})\n        console.log(\"items added to cart\")\n        return {success:true,data:cartItems}\n    }else{\n        console.error(\"user or product doesnt exist\")\n    }\n}\n\nexport const removeItemById = async(id) => {\n        const userDocRef = doc(db,\"users\",auth.currentUser.uid);\n        const userDocSnapshot = await getDoc(userDocRef);\n        if(userDocSnapshot.exists()){\n            const userData = userDocSnapshot.data();\n            const newCart = userData.cart.filter((item)=>item.id!==id);\n            await updateDoc(userDocRef,{cart:newCart})\n            const subTotal = newCart.reduce((acc,curr)=> acc+Number(curr.price))\n            return {data:newCart,success:true,subTotal}\n        }else{\n            console.log(\"user doesn't exists\")\n        }\n    }\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}